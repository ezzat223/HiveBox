name: CI Pipeline

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - 
        name: Checkout code
        uses: actions/checkout@v4
      - 
        name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.12.0'
      - 
        name: Install dependencies
        run: npm install
      - 
        name: Lint code
        run: npm run lint

  docker-build:
    runs-on: ubuntu-latest
    steps:
      - 
        name: Checkout code
        uses: actions/checkout@v4
      - 
        name: Set up Docker
        uses: docker/setup-buildx-action@v3
      - 
        name: Build Docker image
        run: docker build -t hivebox-app .

  # test:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - 
  #       name: Checkout code
  #       uses: actions/checkout@v4
  #     - 
  #       name: Set up Node.js
  #       uses: actions/setup-node@v4
  #       with:
  #         node-version: '20.12.0'
  #     - 
  #       name: Install dependencies
  #       run: npm install
  #     - 
  #       name: Run unit tests
  #       run: npm test
      # -
      #   name: Call /version endpoint and check response
      #   run: |
      #     VERSION=$(curl -s http://localhost:3000/version | jq -r .version)
      #     if [ "$VERSION" != "v0.0.1" ]; then
      #       echo "Version mismatch: expected v0.0.1, got $VERSION"
      #       exit 1
      #     fi


  scorecard: # https://github.com/ossf/scorecard-action#workflow-setup-required
    runs-on: ubuntu-latest
    permissions:
      security-events: write
      id-token: write
    steps:
      - 
        name: Checkout code
        uses: actions/checkout@v4
        with:
          persist-credentials: false
      - 
        name: OpenSSF Scorecard 
        uses: ossf/scorecard-action@0864cf19026789058feabb7e87baa5f140aac736
        with:
          results_file: results.sarif
          results_format: sarif
      - 
        name: "Upload to code-scanning"
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: results.sarif
